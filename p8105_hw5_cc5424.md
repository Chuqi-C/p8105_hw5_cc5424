p8105_hw5_cc5424
================
ChuqiChen
2025-11-13

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

\#problem1

``` r
birthdays = sample(1:365, 5, replace = TRUE)

repeated_bday = length(unique(birthdays)) < 5

repeated_bday
```

    ## [1] FALSE

``` r
bday_sim = function(n_room) {
  
  birthdays = sample(1:365, n_room, replace = TRUE)

  repeated_bday = length(unique(birthdays)) < n_room

  repeated_bday
  
}

bday_sim(20)
```

    ## [1] TRUE

``` r
set.seed(123)

bday_sim_results = 
  expand_grid(
    bdays = 2:50, 
    iter = 1:10000
  ) |>
  mutate(
    result = map2_lgl(bdays, iter, ~ bday_sim(.x))
  ) |>
  group_by(bdays) |>
  summarize(prob_repeat = mean(result))
```

``` r
bday_sim_results |> 
  ggplot(aes(x = bdays, y = prob_repeat)) + 
  geom_point() + 
  geom_line() +
  labs(
    title = "Probability of Shared Birthday vs. Group Size",
    x = "Group size (number of people)",
    y = "Probability of shared birthday"
  ) +
  theme_minimal(base_size = 14)
```

![](p8105_hw5_cc5424_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->
Comment: The probability increases rapidly with group size, exceeding
50% when n ≈ 23, illustrating the well-known birthday paradox.

\#problem2

``` r
# "Fix n = 30" 和 "Fix σ = 5"

n = 30
sigma = 5

# "Set μ = 0. Generate 5000 datasets from the model x ~ Normal[μ, σ]"

set.seed(123)
library(tidyverse)
library(broom)

simulate_ttest = function(mu) {

# 为每个 μ 生成 5000 个样本

replicate(5000, {
x = rnorm(n, mean = mu, sd = sigma)
test = t.test(x, mu = 0)
res = broom::tidy(test)
tibble(
mu_true = mu,
mu_hat = mean(x),
p_value = res$p.value
)
}, simplify = FALSE) |> bind_rows()
}

# "Repeat the above for μ = {1, 2, 3, 4, 5, 6}"

mu_values = 0:6
sim_results = map_df(mu_values, simulate_ttest)

# "Make a plot showing the proportion of times the null was rejected (the power of the test)
# on the y axis and the true value of μ on the x axis."

power_results = sim_results |>
group_by(mu_true) |>
summarize(power = mean(p_value < 0.05))

# 绘图（功效曲线）

ggplot(power_results, aes(x = mu_true, y = power)) +
geom_point(size = 3, color = "steelblue") +
geom_line(color = "steelblue") +
labs(
title = "Power of One-sample t-test vs True Mean (μ)",
x = expression(True~mu),
y = "Power (P(reject H0))"
) +
theme_minimal(base_size = 14)
```

![](p8105_hw5_cc5424_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

``` r
# "Make a plot showing the average estimate of μ̂ on the y axis and the true value of μ on the x axis."

avg_mu_all = sim_results |>
group_by(mu_true) |>
summarize(mean_mu_hat = mean(mu_hat))

ggplot(avg_mu_all, aes(x = mu_true, y = mean_mu_hat)) +
geom_point(size = 3, color = "darkgreen") +
geom_line(color = "darkgreen") +
labs(
title = "Average Estimate of μ̂ Across All Samples",
x = expression(True~mu),
y = expression(Average~hat(mu))
) +
theme_minimal(base_size = 14)
```

![](p8105_hw5_cc5424_files/figure-gfm/unnamed-chunk-6-2.png)<!-- -->

``` r
# "Make a second plot (or overlay on the first) the average estimate of μ̂
# only in samples for which the null was rejected."

avg_mu_reject = sim_results |>
filter(p_value < 0.05) |>
group_by(mu_true) |>
summarize(mean_mu_hat_reject = mean(mu_hat))

# 合并两条曲线

combined_avg = left_join(avg_mu_all, avg_mu_reject, by = "mu_true")

ggplot(combined_avg, aes(x = mu_true)) +
geom_line(aes(y = mean_mu_hat, color = "All samples"), size = 1.2) +
geom_line(aes(y = mean_mu_hat_reject, color = "Only rejected samples"), size = 1.2) +
geom_point(aes(y = mean_mu_hat), color = "darkgreen", size = 2) +
geom_point(aes(y = mean_mu_hat_reject), color = "red", size = 2) +
labs(
title = expression(Average~hat(mu)~vs.~True~mu),
x = expression(True~mu),
y = expression(Average~hat(mu)),
color = "Sample Type"
) +
theme_minimal(base_size = 14)
```

    ## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
    ## ℹ Please use `linewidth` instead.
    ## This warning is displayed once every 8 hours.
    ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
    ## generated.

![](p8105_hw5_cc5424_files/figure-gfm/unnamed-chunk-6-3.png)<!-- -->

``` r
# "Is the sample average of μ̂ across tests for which the null is rejected approximately equal to the true value of μ? Why or why not?"

# Across all samples, the average estimate μ̂ ≈ true μ (unbiased).
# However, for samples where the null is rejected, μ̂ tends to be larger in magnitude
# because only extreme sample means yield small p-values.
# Therefore, conditional on rejection, μ̂ is biased upward (selection bias).
```
